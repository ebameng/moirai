/*!
 * Distpicker v0.1.3
 * https://github.com/fengyuanchen/distpicker
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery","ChineseDistricts"],a):a(jQuery,ChineseDistricts)}(function(a,b){"use strict";if("undefined"==typeof b)throw new Error('The file "distpicker.data.js" must be included first!');var c=function(b,d){this.$element=a(b),this.defaults=a.extend({},c.defaults,a.isPlainObject(d)?d:{}),this.init()};c.prototype={constructor:c,data:b,init:function(){var b=this.$element.find("select"),c=b.length,d={};b.each(function(){a.extend(d,a(this).data())}),d.province?(this.defaults.province=d.province,this.$province=b.filter("[data-province]")):this.$province=c>0?b.eq(0):null,d.city?(this.defaults.city=d.city,this.$city=b.filter("[data-city]")):this.$city=c>1?b.eq(1):null,d.district?(this.defaults.district=d.district,this.$district=b.filter("[data-district]")):this.$district=c>=2?b.eq(2):null,this.output("province"),this.output("city"),this.output("district"),this.addListener()},addListener:function(){var a=this;this.$province&&this.$province.change(function(){a.output("city"),a.output("district")}),this.$city&&this.$city.change(function(){a.output("district")})},output:function(b){var c=1,d={},e=[],f="",g=this["$"+b],h=this;g&&(f=this.defaults[b]||"",c="province"===b?1:"city"===b?this.$province.find("option:selected").data().zipcode:"district"===b?this.$city.find("option:selected").data().zipcode:c,d=a.isNumeric(c)?this.data[c]:{},d=a.isPlainObject(d)?d:{},a.each(d,function(a,b){var c=b===f;c&&(h.selected=!0),e.push(h.template({zipcode:a,address:b,selected:c}))}),this.selected||e.unshift(h.template({zipcode:"",address:f,selected:!1})),g.html(e.join("")))},template:function(b){var c={zipcode:"",address:"",selected:!1};return a.extend(c,b),['<option value="'+(c.address&&c.zipcode?c.address:"")+'"',' data-zipcode="'+(c.zipcode?c.zipcode:"")+'"',c.selected?" selected":"",">"+(c.address?c.address:"")+"</option>"].join("")}},c.defaults={province:"—— 省 ——",city:"—— 市 ——",district:"—— 区 ——"},c.setDefaults=function(b){a.extend(c.defaults,b)},a.fn.distpicker=function(b){return this.each(function(){a(this).data("distpicker",new c(this,b))})},a.fn.distpicker.constructor=c,a.fn.distpicker.setDefaults=c.setDefaults,a(function(){a("[distpicker]").distpicker()})});